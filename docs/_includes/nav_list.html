{% comment %}
    this uses ideas from:
    https://stackoverflow.com/questions/25452429/excluding-page-from-jekyll-navigation-bar
    https://stackoverflow.com/questions/6366188/jekyll-select-current-page-url-and-change-its-class
{% endcomment %}



{% assign page_list=include.page_list%}
{% assign start_level=include.start_level%}
{% assign old_urlpart = '/' %}


<ul>
{% for page_entry in page_list %}
    {% if page_entry.title %}

        {% assign this_url_parts = page_entry.url | split: "/" %}
        {% assign this_level = this_url_parts | size %}
        {% comment %}
            this_level is equal to the index!!
            so we need
            math: - 1
        {% endcomment %}
        {% if this_url_parts.first == "" %}
            {% case this_level %}
              {% when 1 %}
                {% assign this_level = 0 %}
              {% when 2 %}
                {% assign this_level = 1 %}
              {% when 3 %}
                {% assign this_level = 2 %}
              {% when 4 %}
                {% assign this_level = 3 %}
              {% when 5 %}
                {% assign this_level = 4 %}
            {% endcase %}
        {% endif %}

        {% assign this_level_urlpart = this_url_parts[this_level] %}


        {% if page_entry.url contains '.html' %}
            {% comment %}
                math: - 1
            {% endcomment %}
            {% case this_level %}
              {% when 1 %}
                {% assign this_level = 0 %}
              {% when 2 %}
                {% assign this_level = 1 %}
              {% when 3 %}
                {% assign this_level = 2 %}
              {% when 4 %}
                {% assign this_level = 3 %}
              {% when 5 %}
                {% assign this_level = 4 %}
            {% endcase %}
        {% endif %}




        <div>
            <br>
            url: {{ this_url_parts | inspect }}<br>
            depth (s / t / u) :
            {{ start_level | inspect }} /
            {{ this_level | inspect }} /
            {{ this_level_urlpart | inspect }}<br>

            {% comment %}
            this_level: {{ this_level | inspect }}<br>
            this_level_urlpart: {{ this_level_urlpart | inspect }}<br>
            start_level: {{ start_level | inspect }}<br>
            page_entry.url: {{ page_entry.url | inspect }}<br>
            now we have to check if we create an entry for this:
            {% endcomment %}
        </div>




        {% comment %}
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        search for next entry
        {% endcomment %}

        {% assign next_url_parts = nil %}
        {% assign next_level = nil %}
        {% assign next_start = forloop.index %}


        {% for page_entry_next in page_list offset:next_start %}
            {% if page_entry_next.title %}

                {% assign next_url_parts = page_entry_next.url | split: "/" %}
                {% assign next_level = next_url_parts | size %}
                {% comment %}
                    next_level is equal to the index!!
                    so we need
                    math: - 1
                {% endcomment %}
                {% if next_url_parts.first == "" %}
                    {% case next_level %}
                      {% when 1 %}
                        {% assign next_level = 0 %}
                      {% when 2 %}
                        {% assign next_level = 1 %}
                      {% when 3 %}
                        {% assign next_level = 2 %}
                      {% when 4 %}
                        {% assign next_level = 3 %}
                      {% when 5 %}
                        {% assign next_level = 4 %}
                    {% endcase %}
                {% endif %}

                {% assign next_level_urlpart = next_url_parts[next_level] %}

                {% if page_entry_next.url contains '.html' %}
                    {% comment %}
                        math: - 1
                    {% endcomment %}
                    {% case next_level %}
                      {% when 1 %}
                        {% assign next_level = 0 %}
                      {% when 2 %}
                        {% assign next_level = 1 %}
                      {% when 3 %}
                        {% assign next_level = 2 %}
                      {% when 4 %}
                        {% assign next_level = 3 %}
                      {% when 5 %}
                        {% assign next_level = 4 %}
                    {% endcase %}
                {% endif %}

                {% break %}
            {% endif %}
        {% endfor %}

        {% assign next_level_urlpart = next_url_parts[this_level] %}
        <div>
            url: {{ next_url_parts | inspect }}<br>
            depth ns / n / u :
            {{ next_start | inspect }} /
            {{ next_level | inspect }} /
            {{ next_level_urlpart | inspect }}<br>
            {% comment %}
            next_level: {{ next_level | inspect }}<br>
            next_level_urlpart: {{ next_level_urlpart | inspect }}<br>
            {% endcomment %}
        </div>

        {% comment %}
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        {% endcomment %}



        {% comment %}
        ******************************************

        We have something like this:
            /
            /ideas/
            /ideas/POV/
            /ideas/POV/data.html
            /ideas/test1.html
            /ideas/test2.html
            /blubber.html
            /meta.html
            /usage/
            /usage/utest1.html

        target is this:
            /
                /ideas/
                    /ideas/POV/
                        /ideas/POV/data.html
                    /ideas/test1.html
                    /ideas/test2.html
            /blubber.html
            /meta.html
                /usage/
                    /usage/utest1.html


        what options are there ?

        if current entry


        ******************************************
        {% endcomment %}


        {% if this_level == start_level and this_level_urlpart != next_level_urlpart%}
            FINE
            <li
                {% if page.url == page_entry.url %}class="current"{% endif %}
            >
                <a href="{{ page_entry.url }}">{{ page_entry.title }}</a>
            </li>
        {% elsif this_level_urlpart == next_level_urlpart and old_urlpart != this_level_urlpart%}
            {% assign old_urlpart = this_level_urlpart %}
            <li class="sub">
                <a href="{{ page_entry.url }}">{{ page_entry.title }}</a><br>
                ****
                {% comment %}
                    math: + 1
                {% endcomment %}
                {% case this_level %}
                  {% when 0 %}
                    {% assign next_sub_level = 1 %}
                  {% when 1 %}
                    {% assign next_sub_level = 2 %}
                  {% when 2 %}
                    {% assign next_sub_level = 3 %}
                  {% when 3 %}
                    {% assign next_sub_level = 4 %}
                  {% when 4 %}
                    {% assign next_sub_level = 5 %}
                  {% when 5 %}
                    {% assign next_sub_level = 6 %}
                {% endcase %}

                next_sub_level: {{ next_sub_level | inspect }}<br>
                {% assign stack__old_urlpart = stack__old_urlpart | push: this_level_urlpart %}
                {% assign stack__next_urlpart = stack__next_urlpart | push: next_level_urlpart %}
                {% assign stack__this_level = stack__this_level | push: this_level %}
                {% assign stack__start_level = stack__start_level | push: start_level %}
                here we would add the sub things...
                {% comment %}
                {%
                    include nav_list.html
                    page_list=page_list
                    start_level=next_sub_level
                %}
                {% endcomment %}
                {% assign old_urlpart = stack__old_urlpart.last %}
                {% assign stack__old_urlpart = stack__old_urlpart | pop %}
                {% assign next_level_urlpart = stack__next_urlpart.last %}
                {% assign stack__next_urlpart = stack__next_urlpart | pop %}
                {% assign this_level = stack__this_level.last %}
                {% assign stack__this_level = stack__this_level | pop %}
                {% assign start_level = stack__start_level.last %}
                {% assign stack__start_level = stack__start_level | pop %}

            </li>
        {% endif %}

    {% endif %}
{% endfor %}
</ul>
