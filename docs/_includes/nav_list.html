{% comment %}
    this uses ideas from:
    https://stackoverflow.com/questions/25452429/excluding-page-from-jekyll-navigation-bar
    https://stackoverflow.com/questions/6366188/jekyll-select-current-page-url-and-change-its-class



    THIS DOES NOT WORK!!!!!

    The variables are not restored after an reentry.
    (recursive include...)


{% endcomment %}


{% assign page_list=include.page_list%}
{% assign start_depth=include.start_depth%}
{% assign old_urlpart = nil %}



{% comment %}
We have something like this:
    "/ideas/"
    "/ideas/POV/"
    "/ideas/POV/POV_3D/"
    "/ideas/POV/pov_datatransmission.html"
    "/ideas/POV/pov_motor.html"
    "/ideas/POV/pov_powertransmission.html"
    "/meta.html"
---

first we create a array of arrays:
{% endcomment %}

<ul>
{% for page_entry in page_list %}
    {% if page_entry.title %}

        {% assign this_url_parts = page_entry.url | split: "/" %}
        {% assign this_depth = this_url_parts | size %}


        {% comment %}
            math: - 1
        {% endcomment %}
        {% case this_depth %}
          {% when 2 %}
            {% assign temp = 1 %}
          {% when 3 %}
            {% assign temp = 2 %}
          {% when 4 %}
            {% assign temp = 3 %}
          {% when 5 %}
            {% assign temp = 4 %}
        {% endcase %}
        {% assign this_depth_urlpart = this_url_parts[temp] %}

        <br>
        url: {{ this_url_parts | inspect }}<br>
        depth: s/t/t
        {{ start_depth | inspect }} /
        {{ this_depth | inspect }} /
        {{ this_depth_urlpart | inspect }}<br>

        {% comment %}
        this_depth: {{ this_depth | inspect }}<br>
        this_depth_urlpart: {{ this_depth_urlpart | inspect }}<br>
        start_depth: {{ start_depth | inspect }}<br>
        page_entry.url: {{ page_entry.url | inspect }}<br>
        now we have to check if we create an entry for this:
        {% endcomment %}

        {% if page_entry.url contains '.html' %}
            {% comment %}
                math: - 1
            {% endcomment %}
            {% case this_depth %}
              {% when 2 %}
                {% assign this_depth = 1 %}
              {% when 3 %}
                {% assign this_depth = 2 %}
              {% when 4 %}
                {% assign this_depth = 3 %}
              {% when 5 %}
                {% assign this_depth = 4 %}
            {% endcase %}
        {% endif %}
        {% assign create_entry = true %}



        {% if this_depth == start_depth %}
            <li
                {% if page.url == page_entry.url %}class="current"{% endif %}
            >
                <a href="{{ page_entry.url }}">{{ page_entry.title }}</a>
            </li>
        {% elsif this_depth > start_depth and old_urlpart != this_depth_urlpart %}
            {% assign old_urlpart = this_depth_urlpart %}
            <li class="sub">
                <a href="{{ page_entry.url }}">{{ page_entry.title }}</a><br>
                ****
                {% comment %}
                    math: + 1
                {% endcomment %}
                {% case this_depth %}
                  {% when 2 %}
                    {% assign next_depth = 3 %}
                  {% when 3 %}
                    {% assign next_depth = 4 %}
                  {% when 4 %}
                    {% assign next_depth = 5 %}
                  {% when 5 %}
                    {% assign next_depth = 6 %}
                {% endcase %}

                next_depth: {{ next_depth | inspect }}<br>
                {% assign stack__old_urlpart = stack__old_urlpart | push: this_depth_urlpart %}
                {% assign stack__this_depth = stack__this_depth | push: this_depth %}
                {% assign stack__start_depth = stack__start_depth | push: start_depth %}
                {%
                    include nav_list.html
                    page_list=page_list
                    start_depth=next_depth
                %}
                {% assign old_urlpart = stack__old_urlpart.last %}
                {% assign stack__old_urlpart = stack__old_urlpart | pop %}
                {% assign this_depth = stack__this_depth.last %}
                {% assign stack__this_depth = stack__this_depth | pop %}
                {% assign start_depth = stack__start_depth.last %}
                {% assign stack__start_depth = stack__start_depth | pop %}

            </li>
        {% endif %}

    {% endif %}
{% endfor %}
</ul>
